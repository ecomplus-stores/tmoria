{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-product-card/src/index.js","webpack:///./node_modules/@ecomplus/storefront-template/template/js/lib/load-widgets.js"],"names":["options","elClass","buyText","window","productCardBuyText","buy","productCardBuyHtml","footer","productCardFooterHtml","getScopedSlots","storefront","$productCards","document","querySelectorAll","productIds","i","length","productId","toRender","dataset","indexOf","push","preFetchPromise","skipSearchApi","search","EcomSearch","setPageSize","setProductIds","fetch","timeout","then","items","getItems","load","catch","err","console","error","Promise","resolve","$productCard","sku","product","Array","isArray","find","_id","finally","isLoaded","available","visible","checkInStock","$cardLi","parentNode","tagName","appendChild","$productItem","JSON","parse","e","undefined","Vue","render","h","ProductCard","class","attrs","props","transitionClass","scopedSlots","$mount","setupComponent","lozad","rootMargin","threshold","observe","isCheckout","location","pathname","startsWith","widgetsLoadPromises","widgetsMsDelay","hostname","loadWidget","pkg","runImport","waitWidgetResolve","setTimeout","widget","_widgets","active","desktopOnly","isMobile","enableCheckout","disablePages","exp","default","emitter","emit","log","resource","body","all","widgetProductCard","getElementById","requestIdleCallback","fn"],"mappings":"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","file":"chunk.ed9516f2740daee01b37.js","sourcesContent":["/*!\n * @ecomplus/widget-product-card\n * (c) E-Com Club <ti@e-com.club>\n * Released under the MIT License.\n */\n\nimport Vue from 'vue'\nimport lozad from 'lozad'\nimport { inStock as checkInStock } from '@ecomplus/utils'\nimport EcomSearch from '@ecomplus/search-engine'\nimport ProductCard from '#components/ProductCard.vue'\n\nexport default (options = {}, elClass = 'product-card') => {\n  if (options.buyText) {\n    window.productCardBuyText = options.buyText\n  }\n  if (options.buy) {\n    window.productCardBuyHtml = options.buy\n  }\n  if (options.footer) {\n    window.productCardFooterHtml = options.footer\n  }\n  const getScopedSlots = window.storefront && window.storefront.getScopedSlots\n\n  const setupComponent = ($productCard, productId, sku, product, isLoaded) => {\n    new Vue({\n      render: h => h(ProductCard, {\n        class: elClass !== 'product-card' ? elClass : null,\n        attrs: {\n          'data-product-id': productId,\n          'data-sku': sku\n        },\n        props: {\n          ...options.props,\n          productId,\n          product,\n          isLoaded,\n          transitionClass: null\n        },\n        scopedSlots: typeof getScopedSlots === 'function'\n          ? getScopedSlots($productCard, h)\n          : undefined\n      })\n    }).$mount($productCard)\n  }\n\n  const $productCards = document.querySelectorAll(`.${elClass}`)\n  const productIds = []\n  for (let i = 0; i < $productCards.length; i++) {\n    if ($productCards[i]) {\n      const { productId, toRender } = $productCards[i].dataset\n      if (toRender && productIds.indexOf(productId) === -1) {\n        productIds.push(productId)\n      }\n    }\n  }\n\n  let preFetchPromise\n  if (productIds.length >= 4 && productIds.length <= 70 && !options.skipSearchApi) {\n    const search = new EcomSearch()\n    preFetchPromise = search\n      .setPageSize(productIds.length)\n      .setProductIds(productIds)\n      .fetch(true, { timeout: 5000 })\n      .then(() => {\n        const items = search.getItems()\n        for (let i = 0; i < 2; i++) {\n          load($productCards[i])\n        }\n        return items\n      })\n      .catch(err => {\n        console.error(err)\n      })\n  } else {\n    preFetchPromise = Promise.resolve()\n  }\n\n  const load = $productCard => {\n    if ($productCard) {\n      const { productId, sku, toRender } = $productCard.dataset\n      if (toRender) {\n        let product\n\n        preFetchPromise\n          .then(items => {\n            if (Array.isArray(items)) {\n              product = items.find(({ _id }) => _id === productId)\n            }\n          })\n\n          .finally(() => {\n            let isLoaded\n            if (product) {\n              isLoaded = true\n              if (!product.available || !product.visible || !checkInStock(product)) {\n                const $cardLi = $productCard.parentNode && $productCard.parentNode.parentNode\n                if ($cardLi && $cardLi.tagName === 'LI') {\n                  $cardLi.parentNode.appendChild($cardLi)\n                }\n              }\n            } else {\n              const $productItem = $productCard.parentNode\n              if ($productItem) {\n                product = $productItem.dataset.product\n                if (typeof product === 'string') {\n                  try {\n                    product = JSON.parse(product)\n                  } catch (e) {\n                    product = undefined\n                  }\n                }\n              }\n            }\n            setupComponent($productCard, productId, sku, product, isLoaded)\n          })\n      }\n    }\n  }\n\n  const observer = lozad($productCards, {\n    rootMargin: '350px 0px',\n    threshold: 0,\n    load\n  })\n  observer.observe()\n}\n","import { isMobile } from '@ecomplus/storefront-twbs'\nimport emitter from './emitter'\nimport widgetProductCard from '@ecomplus/widget-product-card'\n\nconst isCheckout = window.location.pathname.startsWith('/app/')\nconst widgetsLoadPromises = []\nconst widgetsMsDelay = window.location.hostname === 'localhost' ? 50 : 1\n\nconst loadWidget = (pkg, runImport) => {\n  const waitWidgetResolve = new Promise(resolve => {\n    setTimeout(() => {\n      const widget = window._widgets && window._widgets[pkg]\n      if (\n        widget &&\n        widget.active &&\n        (!widget.desktopOnly || !isMobile) &&\n        (isCheckout ? widget.enableCheckout : !widget.disablePages)\n      ) {\n        return runImport()\n          .then(exp => {\n            if (typeof exp.default === 'function') {\n              exp.default(widget.options)\n            }\n            emitter.emit(`widget:${pkg}`)\n            console.log(`Widget loaded: ${pkg}`)\n          })\n          .catch(console.error)\n          .finally(resolve)\n      }\n\n      resolve()\n    }, widgetsMsDelay)\n  })\n\n  widgetsLoadPromises.push(waitWidgetResolve)\n}\n\nconst { resource } = document.body.dataset\nif (!isCheckout && resource === 'products') {\n  loadWidget(\n    '@ecomplus/widget-product',\n    () => import(/* webpackPrefetch: true */ '@ecomplus/widget-product')\n  )\n}\n\nPromise.all(widgetsLoadPromises).then(() => {\n  loadWidget(\n    '@ecomplus/widget-product-card',\n    () => Promise.resolve({ default: widgetProductCard })\n  )\n\n  if (\n    window.location.pathname === '/search' ||\n    resource === 'categories' ||\n    resource === 'brands' ||\n    (!resource && document.getElementById('search-engine'))\n  ) {\n    loadWidget(\n      '@ecomplus/widget-search-engine',\n      () => import(/* webpackPrefetch: true */ '@ecomplus/widget-search-engine')\n    )\n  }\n\n  const requestIdleCallback = fn => {\n    if (typeof window.requestIdleCallback === 'function') {\n      setTimeout(() => window.requestIdleCallback(fn), 200)\n    } else {\n      setTimeout(fn, 800)\n    }\n  }\n\n  requestIdleCallback(() => {\n    emitter.emit('load:lcp')\n\n    if (!isCheckout) {\n      loadWidget(\n        '@ecomplus/widget-search',\n        () => import('@ecomplus/widget-search')\n      )\n      loadWidget(\n        '@ecomplus/widget-minicart',\n        () => import('@ecomplus/widget-minicart')\n      )\n      loadWidget(\n        '@ecomplus/widget-user',\n        () => import('@ecomplus/widget-user')\n      )\n    }\n\n    Promise.all(widgetsLoadPromises).then(() => {\n      requestIdleCallback(() => emitter.emit('load:components'))\n\n      loadWidget(\n        '@ecomplus/widget-tag-manager',\n        () => import('@ecomplus/widget-tag-manager')\n      )\n      loadWidget(\n        '@ecomplus/widget-analytics',\n        () => import('@ecomplus/widget-analytics')\n      )\n      loadWidget(\n        '@ecomplus/widget-fb-pixel',\n        () => import('@ecomplus/widget-fb-pixel')\n      )\n      loadWidget(\n        '@ecomplus/widget-gmc-ratings',\n        () => import('@ecomplus/widget-gmc-ratings')\n      )\n      loadWidget(\n        '@ecomplus/widget-ebit',\n        () => import('@ecomplus/widget-ebit')\n      )\n      loadWidget(\n        '@ecomplus/widget-compre-confie',\n        () => import('@ecomplus/widget-compre-confie')\n      )\n    })\n  })\n})\n"],"sourceRoot":""}